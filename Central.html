<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Central SCI JOI - Dashboard Operacional</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }

        .header {
            background: radial-gradient(circle at center, #1e3a8a 0%, #0f172a 100%);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .alert-card {
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .alert-card:hover {
            transform: translateX(4px);
            border-left-color: currentColor;
        }

        .status-badge {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1;
                transform: scale(1);
            }
            50% { 
                opacity: 0.5;
                transform: scale(1.1);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        .fade-in:nth-child(1) { animation-delay: 0.1s; }
        .fade-in:nth-child(2) { animation-delay: 0.2s; }
        .fade-in:nth-child(3) { animation-delay: 0.3s; }
        .fade-in:nth-child(4) { animation-delay: 0.4s; }

        .sistema-card {
            position: relative;
            overflow: hidden;
        }

        .sistema-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sistema-card:hover::before {
            opacity: 1;
        }

        /* Scrollbar customizado */
        ::-webkit-scrollbar { 
            width: 8px; 
            height: 8px;
        }

        ::-webkit-scrollbar-track { 
            background: rgba(15, 23, 42, 0.1); 
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb { 
            background: rgba(59, 130, 246, 0.5); 
            border-radius: 10px; 
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.8);
        }

        /* Animação para números */
        @keyframes countUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .count-animation {
            animation: countUp 0.5s ease-out;
        }

        /* Responsividade */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.75rem;
            }
            
            #equipeAtual {
                font-size: 3rem;
            }
            
            #proximaTroca {
                font-size: 2rem;
            }
        }

        /* Efeito de hover nos alertas */
        .alert-hover:hover {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
        }

        /* Badge pulsante para alertas críticos */
        .badge-pulse {
            animation: badgePulse 1.5s ease-in-out infinite;
        }

        @keyframes badgePulse {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(239, 68, 68, 0);
            }
        }

        /* Loading skeleton */
        .skeleton {
            background: linear-gradient(90deg, #f1f5f9 25%, #e2e8f0 50%, #f1f5f9 75%);
            background-size: 200% 100%;
            animation: loading 1.5s ease-in-out infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <div class="header">
        <div class="max-w-7xl mx-auto px-6 py-8 flex flex-col md:flex-row items-center justify-between gap-6">
            <div class="flex items-center gap-4">
                <img src="https://lh3.googleusercontent.com/u/0/d/1qRTQ2m7853VqWVPnms99f0cPBlQHahXq" 
                     alt="Logo SCI" 
                     class="w-20 h-20 rounded-full bg-white p-2 shadow-2xl"
                     onerror="this.src='https://via.placeholder.com/150x150?text=SCI';">
                <div>
                    <h1 class="text-4xl font-black text-white tracking-tight">Central SCI JOI</h1>
                    <p class="text-slate-300 text-sm font-semibold tracking-widest uppercase">Sistema de Controle Integrado</p>
                </div>
            </div>
            
            <div class="flex flex-col items-end gap-2">
                <div class="text-white text-right">
                    <p id="currentDate" class="text-sm font-bold opacity-90"></p>
                    <p id="currentTime" class="text-3xl font-black tracking-tight"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Container Principal -->
    <div class="max-w-7xl mx-auto px-6 py-8">

        <!-- Primeira Linha: Equipe de Plantão + PTR-BA Hoje -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            
            <!-- Card Equipe de Plantão -->
            <div class="glass-card rounded-3xl p-8 fade-in">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div class="bg-blue-100 p-3 rounded-xl">
                            <i data-lucide="users" class="w-7 h-7 text-blue-600"></i>
                        </div>
                        <div>
                            <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest">Equipe de Plantão</h2>
                            <p class="text-xs text-slate-500 font-semibold">Atualização automática</p>
                        </div>
                    </div>
                    <div class="status-badge w-3 h-3 bg-emerald-500 rounded-full"></div>
                </div>
                
                <div class="text-center py-6">
                    <div id="equipeAtual" class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-4">
                        CHARLIE
                    </div>
                    <p class="text-slate-600 font-semibold mb-4">Troca de equipe em</p>
                    <div id="proximaTroca" class="text-3xl font-black text-slate-800">
                        --:--:--
                    </div>
                    <p id="proximaEquipe" class="text-sm text-slate-500 font-bold mt-2">
                        Próxima: DELTA às 17:00
                    </p>
                </div>
            </div>

            <!-- Card PTR-BA Hoje -->
            <div class="glass-card rounded-3xl p-8 fade-in">
                <div class="flex items-center gap-3 mb-6">
                    <div class="bg-amber-100 p-3 rounded-xl">
                        <i data-lucide="clipboard-list" class="w-7 h-7 text-amber-600"></i>
                    </div>
                    <div>
                        <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest">PTR-BA Hoje</h2>
                        <p id="ptrData" class="text-xs text-slate-500 font-semibold">Carregando...</p>
                    </div>
                </div>
                
                <div id="treinamentosHoje" class="space-y-3">
                    <div class="flex items-center gap-3 p-4 bg-slate-50 rounded-xl">
                        <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse"></div>
                        <p class="text-sm text-slate-500 italic">Carregando treinamentos...</p>
                    </div>
                </div>
            </div>

        </div>

        <!-- Segunda Linha: Alertas Consolidados -->
        <div class="glass-card rounded-3xl p-8 mb-8 fade-in">
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-red-100 p-3 rounded-xl">
                    <i data-lucide="alert-circle" class="w-7 h-7 text-red-600"></i>
                </div>
                <div>
                    <h2 class="text-sm font-black text-slate-400 uppercase tracking-widest">Alertas Consolidados</h2>
                    <p class="text-xs text-slate-500 font-semibold">Atualização em tempo real</p>
                </div>
            </div>
            
            <div id="alertasContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="p-4 bg-slate-50 rounded-xl text-center">
                    <p class="text-sm text-slate-400 italic">Carregando alertas...</p>
                </div>
            </div>
        </div>

        <!-- Terceira Linha: Cards dos Sistemas -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            
            <!-- Card TAF -->
            <div class="glass-card rounded-3xl p-6 sistema-card fade-in cursor-pointer" onclick="abrirSistema('taf')">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-gradient-to-br from-blue-500 to-purple-600 p-3 rounded-xl">
                        <i data-lucide="activity" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-black text-slate-800 text-lg">TAF</h3>
                        <p class="text-xs text-slate-500 font-semibold">Teste de Aptidão Física</p>
                    </div>
                </div>
                
                <div class="space-y-3 mb-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400 uppercase">Taxa Aprovação</span>
                        <span id="tafAprovacao" class="text-lg font-black text-emerald-600">--%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400 uppercase">Média Nota</span>
                        <span id="tafMedia" class="text-lg font-black text-blue-600">--</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-bold text-slate-400 uppercase">Alertas</span>
                        <span id="tafAlertas" class="px-3 py-1 bg-red-100 text-red-700 text-xs font-black rounded-full">0</span>
                    </div>
                </div>
                
                <button class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-xl font-bold text-sm hover:shadow-lg transition-all flex items-center justify-center gap-2">
                    <span>Abrir Sistema</span>
                    <i data-lucide="arrow-right" class="w-4 h-4"></i>
                </button>
            </div>

            <!-- Card Sistema 2 -->
            <div class="glass-card rounded-3xl p-6 sistema-card fade-in cursor-pointer opacity-50">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-gradient-to-br from-emerald-500 to-teal-600 p-3 rounded-xl">
                        <i data-lucide="file-text" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-black text-slate-800 text-lg">Sistema 2</h3>
                        <p class="text-xs text-slate-500 font-semibold">Em desenvolvimento</p>
                    </div>
                </div>
                
                <div class="py-8 text-center">
                    <i data-lucide="clock" class="w-12 h-12 text-slate-300 mx-auto mb-2"></i>
                    <p class="text-xs text-slate-400 font-semibold">Em breve</p>
                </div>
            </div>

            <!-- Card Sistema 3 -->
            <div class="glass-card rounded-3xl p-6 sistema-card fade-in cursor-pointer opacity-50">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-gradient-to-br from-amber-500 to-orange-600 p-3 rounded-xl">
                        <i data-lucide="bar-chart" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h3 class="font-black text-slate-800 text-lg">Sistema 3</h3>
                        <p class="text-xs text-slate-500 font-semibold">Em desenvolvimento</p>
                    </div>
                </div>
                
                <div class="py-8 text-center">
                    <i data-lucide="clock" class="w-12 h-12 text-slate-300 mx-auto mb-2"></i>
                    <p class="text-xs text-slate-400 font-semibold">Em breve</p>
                </div>
            </div>

        </div>

    </div>

    <script>
        // URLs das fontes de dados
        const TAF_SPREADSHEET_ID = '1AQvblyoMbIjvoafUx92QQnBEj-DWERvDwwlMy7Q1xSo';
        const TAF_JSON_URL = `https://docs.google.com/spreadsheets/d/${TAF_SPREADSHEET_ID}/gviz/tq?tqx=out:json&gid=0`;

        const PTR_SPREADSHEET_ID = '1_UJdUt466IFbupbkX1ucMcsOnfbLoPp7W_B0hfbdl6o';
        const PTR_JSON_URL = `https://docs.google.com/spreadsheets/d/${PTR_SPREADSHEET_ID}/gviz/tq?tqx=out:json&gid=0`;

        // Variáveis globais
        let dadosTAF = [];
        let dadosPTR = [];

        // ============================================
        // SISTEMA DE EQUIPES DE PLANTÃO
        // ============================================

        // Referência: Agora (15/01/2026 às 18:53) = CHARLIE
        // Próxima troca: 17:00 = DELTA
        const EQUIPES = ['ALFA', 'BRAVO', 'CHARLIE', 'DELTA'];
        const HORARIOS_TROCA = [
            { hora: 5, minuto: 0 },   // 05:00
            { hora: 17, minuto: 0 }   // 17:00
        ];

        // Data/hora de referência fornecida pelo usuário
        const REFERENCIA = {
            data: new Date('2026-01-15T18:53:00'),  // 15/01/2026 às 18:53
            equipe: 'CHARLIE',                       // Equipe atual neste momento
            proximaEquipe: 'DELTA',                  // Próxima às 17:00
            proximaHora: 17
        };

        function calcularEquipeAtual() {
            const agora = new Date();
            
            // Calcular quantas trocas aconteceram desde a referência
            const diffMs = agora - REFERENCIA.data;
            const diffHoras = diffMs / (1000 * 60 * 60);
            
            // Cada ciclo completo = 12 horas (05:00 → 17:00 → 05:00)
            const trocasPorDia = 2;
            const horasPorTroca = 12;
            
            // Quantas trocas completas desde a referência?
            let trocasDesdeRef = Math.floor(diffHoras / horasPorTroca);
            
            // Índice da equipe de referência
            const indiceRef = EQUIPES.indexOf(REFERENCIA.equipe);
            
            // Calcular índice atual (rotação circular)
            const indiceAtual = (indiceRef + trocasDesdeRef) % EQUIPES.length;
            
            return EQUIPES[indiceAtual];
        }

        function calcularProximaTroca() {
            const agora = new Date();
            const hora = agora.getHours();
            const minuto = agora.getMinutes();
            
            let proximaTroca = new Date(agora);
            let proximaEquipe = '';
            
            // Se for antes das 05:00, próxima troca é às 05:00 de hoje
            if (hora < 5) {
                proximaTroca.setHours(5, 0, 0, 0);
            }
            // Se for entre 05:00 e 17:00, próxima troca é às 17:00 de hoje
            else if (hora < 17) {
                proximaTroca.setHours(17, 0, 0, 0);
            }
            // Se for depois das 17:00, próxima troca é às 05:00 de amanhã
            else {
                proximaTroca.setDate(proximaTroca.getDate() + 1);
                proximaTroca.setHours(5, 0, 0, 0);
            }
            
            // Calcular qual será a próxima equipe
            const equipeAtual = calcularEquipeAtual();
            const indiceAtual = EQUIPES.indexOf(equipeAtual);
            proximaEquipe = EQUIPES[(indiceAtual + 1) % EQUIPES.length];
            
            return { 
                data: proximaTroca, 
                equipe: proximaEquipe,
                horario: proximaTroca.getHours() === 5 ? '05:00' : '17:00'
            };
        }

        function atualizarEquipePlantao() {
            const equipeAtual = calcularEquipeAtual();
            const proximaTroca = calcularProximaTroca();
            
            // Atualizar display da equipe atual
            document.getElementById('equipeAtual').textContent = equipeAtual;
            
            // Atualizar próxima equipe
            document.getElementById('proximaEquipe').textContent = 
                `Próxima: ${proximaTroca.equipe} às ${proximaTroca.horario}`;
            
            // Atualizar contador regressivo
            atualizarContadorTroca(proximaTroca.data);
        }

        function atualizarContadorTroca(proximaTroca) {
            const agora = new Date();
            const diff = proximaTroca - agora;
            
            if (diff <= 0) {
                // Se passou da hora, recalcular
                atualizarEquipePlantao();
                return;
            }
            
            const horas = Math.floor(diff / (1000 * 60 * 60));
            const minutos = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const segundos = Math.floor((diff % (1000 * 60)) / 1000);
            
            document.getElementById('proximaTroca').textContent = 
                `${String(horas).padStart(2, '0')}:${String(minutos).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
        }

        // ============================================
        // RELÓGIO E DATA
        // ============================================

        function atualizarRelogio() {
            const agora = new Date();
            
            const data = agora.toLocaleDateString('pt-BR', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            const hora = agora.toLocaleTimeString('pt-BR', { 
                hour: '2-digit', 
                minute: '2-digit',
                second: '2-digit'
            });
            
            document.getElementById('currentDate').textContent = data;
            document.getElementById('currentTime').textContent = hora;
        }

        // ============================================
        // CARREGAR DADOS DO TAF
        // ============================================

        async function carregarDadosTAF() {
            try {
                const response = await fetch(TAF_JSON_URL);
                const text = await response.text();
                const json = JSON.parse(text.substring(47).slice(0, -2));
                const rows = json.table.rows;

                dadosTAF = rows.slice(1).map((row) => {
                    const cellData = row.c[0]?.f || row.c[0]?.v || "";
                    const cellNome = row.c[1]?.v || "";
                    const cellTempoTotal = row.c[8]?.f || row.c[8]?.v || "00:00:00";
                    const cellIdade = row.c[4]?.v || 0;

                    const tempoSeg = parseTimeToSeconds(cellTempoTotal);
                    const nota = calcularNota(tempoSeg, cellIdade);

                    return {
                        data: cellData,
                        dateObject: parseDate(cellData),
                        nome: cellNome,
                        idade: cellIdade,
                        tempoSeg: tempoSeg,
                        nota: nota
                    };
                }).filter(d => d.nome && d.nome !== '' && d.tempoSeg > 0);

                processarDadosTAF();
            } catch (error) {
                console.error("Erro ao carregar TAF:", error);
            }
        }

        function parseDate(dateStr) {
            if (!dateStr) return null;
            const parts = dateStr.split('/');
            return parts.length === 3 ? new Date(parts[2], parts[1] - 1, parts[0]) : null;
        }

        function parseTimeToSeconds(val) {
            if (!val) return 0;
            const parts = val.toString().split(':').map(Number);
            if (parts.length === 3) return (parts[0] * 3600) + (parts[1] * 60) + parts[2];
            if (parts.length === 2) return (parts[0] * 60) + parts[1];
            return 0;
        }

        function calcularNota(tempoSegundos, idade) {
            if (idade <= 40) {
                if (tempoSegundos <= 120) return 10;
                if (tempoSegundos <= 140) return 9;
                if (tempoSegundos <= 160) return 8;
                if (tempoSegundos <= 180) return 7;
                return 0;
            } else {
                if (tempoSegundos <= 180) return 10;
                if (tempoSegundos <= 200) return 9;
                if (tempoSegundos <= 220) return 8;
                if (tempoSegundos <= 240) return 7;
                return 0;
            }
        }

        function processarDadosTAF() {
            // Pegar apenas último teste de cada BA
            const ultimosTestes = {};
            dadosTAF.forEach(d => {
                if (!ultimosTestes[d.nome] || d.dateObject > ultimosTestes[d.nome].dateObject) {
                    ultimosTestes[d.nome] = d;
                }
            });
            const dados = Object.values(ultimosTestes);

            // Calcular KPIs
            const aprovados = dados.filter(d => d.nota >= 7).length;
            const taxaAprovacao = ((aprovados / dados.length) * 100).toFixed(1);
            const mediaNota = (dados.reduce((acc, d) => acc + d.nota, 0) / dados.length).toFixed(1);

            document.getElementById('tafAprovacao').textContent = `${taxaAprovacao}%`;
            document.getElementById('tafMedia').textContent = mediaNota;

            // Gerar alertas
            gerarAlertasTAF(dados);
        }

        function gerarAlertasTAF(dados) {
            const alertas = [];
            const hoje = new Date();

            // Reprovados
            const reprovados = dados.filter(d => d.nota < 7);
            if (reprovados.length > 0) {
                alertas.push({
                    sistema: 'TAF',
                    tipo: 'reprovados',
                    prioridade: 'alta',
                    icone: 'x-circle',
                    cor: 'red',
                    titulo: 'Reprovações no TAF',
                    mensagem: `${reprovados.length} bombeiro(s) reprovado(s)`,
                    quantidade: reprovados.length
                });
            }

            // Limítrofes
            const limitrofe = dados.filter(d => d.nota === 7);
            if (limitrofe.length > 0) {
                alertas.push({
                    sistema: 'TAF',
                    tipo: 'limitrofe',
                    prioridade: 'media',
                    icone: 'alert-triangle',
                    cor: 'amber',
                    titulo: 'Desempenho Limítrofe',
                    mensagem: `${limitrofe.length} bombeiro(s) com nota mínima`,
                    quantidade: limitrofe.length
                });
            }

            // Vencidos
            const vencidos = dados.filter(d => {
                if (!d.dateObject) return false;
                const diffDias = Math.floor((hoje - d.dateObject) / (1000 * 60 * 60 * 24));
                return diffDias > 90;
            });
            if (vencidos.length > 0) {
                alertas.push({
                    sistema: 'TAF',
                    tipo: 'vencidos',
                    prioridade: 'alta',
                    icone: 'calendar-x',
                    cor: 'orange',
                    titulo: 'Testes Vencidos',
                    mensagem: `${vencidos.length} teste(s) vencido(s) há +90 dias`,
                    quantidade: vencidos.length
                });
            }

            // Atualizar badge de alertas
            const totalAlertas = alertas.length;
            document.getElementById('tafAlertas').textContent = totalAlertas;

            // Renderizar alertas
            renderizarAlertas(alertas);
        }

        // ============================================
        // CARREGAR PTR-BA (Treinamentos)
        // ============================================

        async function carregarPTR() {
            try {
                const response = await fetch(PTR_JSON_URL);
                const text = await response.text();
                const json = JSON.parse(text.substring(47).slice(0, -2));
                const rows = json.table.rows;

                // Primeira linha = cabeçalho com mês
                const headerRow = rows[0];
                const mesAtual = headerRow.c[0]?.v || "";

                // Obter dia atual
                const hoje = new Date();
                const diaHoje = hoje.getDate();

                // Encontrar linha do dia atual
                let treinamentosHoje = [];
                for (let i = 1; i < rows.length; i++) {
                    const row = rows[i];
                    const dia = row.c[0]?.v || "";
                    
                    if (parseInt(dia) === diaHoje) {
                        // Coletar até 4 treinamentos (colunas 1, 2, 3, 4)
                        for (let col = 1; col <= 4; col++) {
                            const treinamento = row.c[col]?.v || "";
                            if (treinamento && treinamento.trim() !== "") {
        treinamentosHoje.push(treinamento);
        }
        }
        break;
        }
        }
            // Atualizar UI
            document.getElementById('ptrData').textContent = 
                `${diaHoje}/${mesAtual.split('/')[0]}`;
            
            renderizarTreinamentos(treinamentosHoje);
        } catch (error) {
            console.error("Erro ao carregar PTR:", error);
            document.getElementById('treinamentosHoje').innerHTML = 
                '<div class="p-4 bg-red-50 rounded-xl text-sm text-red-700">Erro ao carregar treinamentos</div>';
        }
        }
        function renderizarTreinamentos(treinamentos) {
        const container = document.getElementById('treinamentosHoje');
        if (treinamentos.length === 0) {
            container.innerHTML = `
                <div class="flex items-center gap-3 p-4 bg-emerald-50 rounded-xl border border-emerald-100">
                    <i data-lucide="check-circle" class="w-5 h-5 text-emerald-600"></i>
                    <p class="text-sm text-emerald-700 font-semibold">Sem treinamentos agendados para hoje</p>
                </div>
            `;
            lucide.createIcons();
            return;
        }

        const cores = ['blue', 'purple', 'emerald', 'amber'];

        container.innerHTML = treinamentos.map((t, index) => `
            <div class="flex items-start gap-3 p-4 bg-${cores[index]}-50 rounded-xl border border-${cores[index]}-100">
                <div class="bg-${cores[index]}-100 p-2 rounded-lg flex-shrink-0">
                    <i data-lucide="bookmark" class="w-4 h-4 text-${cores[index]}-600"></i>
                </div>
                <p class="text-sm text-${cores[index]}-900 font-semibold leading-relaxed">${t}</p>
            </div>
        `).join('');

        lucide.createIcons();
        }
        // ============================================
        // RENDERIZAR ALERTAS CONSOLIDADOS
        // ============================================
        function renderizarAlertas(alertas) {
        const container = document.getElementById('alertasContainer');
        if (alertas.length === 0) {
            container.innerHTML = `
                <div class="col-span-2 p-8 bg-emerald-50 rounded-2xl border-2 border-emerald-100 text-center">
                    <i data-lucide="check-circle-2" class="w-16 h-16 text-emerald-600 mx-auto mb-3"></i>
                    <p class="text-lg font-black text-emerald-800">Sistema Operacional</p>
                    <p class="text-sm text-emerald-600 font-semibold mt-1">Nenhum alerta no momento</p>
                </div>
            `;
            lucide.createIcons();
            return;
        }

        container.innerHTML = alertas.map(a => `
            <div class="alert-card alert-hover p-4 bg-${a.cor}-50 rounded-xl border-l-4 border-${a.cor}-500">
                <div class="flex items-start gap-3">
                    <div class="bg-${a.cor}-100 p-2 rounded-lg flex-shrink-0">
                        <i data-lucide="${a.icone}" class="w-5 h-5 text-${a.cor}-600"></i>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-1">
                            <p class="text-xs font-black text-${a.cor}-600 uppercase tracking-wider">${a.sistema}</p>
                            <span class="px-2 py-1 bg-${a.cor}-100 text-${a.cor}-700 text-xs font-black rounded-full badge-pulse">${a.quantidade}</span>
                        </div>
                        <p class="text-sm font-bold text-slate-800">${a.titulo}</p>
                        <p class="text-xs text-slate-600 font-semibold mt-1">${a.mensagem}</p>
                    </div>
                </div>
            </div>
        `).join('');

        lucide.createIcons();
        }
        // ============================================
        // NAVEGAÇÃO
        // ============================================
        function abrirSistema(sistema) {
        if (sistema === 'taf') {
        window.location.href = 'TAF.html'; // Ajuste o caminho conforme necessário
        }
        }
        // ============================================
        // INICIALIZAÇÃO
        // ============================================
        function init() {
        // Atualizar relógio
        atualizarRelogio();
        setInterval(atualizarRelogio, 1000);
        // Atualizar equipe de plantão
        atualizarEquipePlantao();
        setInterval(atualizarEquipePlantao, 1000);

        // Carregar dados
        carregarDadosTAF();
        carregarPTR();

        // Recarregar dados a cada 5 minutos
        setInterval(carregarDadosTAF, 5 * 60 * 1000);
        setInterval(carregarPTR, 5 * 60 * 1000);

        // Inicializar ícones Lucide
        lucide.createIcons();
        }
        // Iniciar quando página carregar
        window.addEventListener('load', init);
    </script>
</body>
</html>
